{% extends 'base.html' %}
{% load static %}

{% block title %}Perfil de {{ usuario_perfil.username }}{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/perfil.css' %}">
{% endblock %}

{% block content %}
<div class="perfil-container">

  <!-- Cabeçalho do perfil -->
  <div class="perfil-header">
    {% if usuario_perfil.profile.imagem %}
      <img class="perfil-avatar" src="{{ usuario_perfil.profile.imagem.url }}" alt="Imagem de perfil">
    {% else %}
      <img class="perfil-avatar" src="{% static 'img/default-profile.png' %}" alt="Imagem padrão">
    {% endif %}

    <div class="perfil-info">
      <h1>{{ usuario_perfil.first_name }}</h1>
      <p class="username">@{{ usuario_perfil.username }}</p>

      {% if usuario_perfil == request.user %}
        <a href="{% url 'editar_perfil' %}" class="btn-edit-profile">Editar perfil</a>

      {% else %}
        {% if seguindo_usuario_logado %}
          <form action="{% url 'deixar_de_seguir_usuario' usuario_perfil.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn-unfollow">Deixar de Seguir</button>

          </form>

        {% else %}
          <form action="{% url 'seguir_usuario' usuario_perfil.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn-follow">Seguir</button>

          </form>
        {% endif %}

      {% endif %}

    </div>

  </div>

  <!-- ABAS -->
  <div class="perfil-tabs">
    <button class="tab active" data-target="seguidores">Seguidores ({{ seguidores.count }})</button>
    <button class="tab" data-target="seguindo">Seguindo ({{ seguindo.count }})</button>

  </div>

  <div id="seguidores" class="tab-content active">
    {% if seguidores %}
      <ul class="perfil-lista-usuarios">
        {% for rel in seguidores %}
          <li>
            <a href="{% url 'perfil' rel.seguidor.username %}">
              {% if rel.seguidor.profile.imagem %}
                <img src="{{ rel.seguidor.profile.imagem.url }}" alt="Foto de {{ rel.seguidor.username }}">
              {% else %}
                <img src="{% static 'img/default-profile.png' %}" alt="Foto padrão">
              {% endif %}

              <div class="info">
                <strong>{{ rel.seguidor.first_name }}</strong>
                <span>@{{ rel.seguidor.username }}</span>

              </div>

            </a>

          </li>
        {% endfor %}

      </ul>

    {% else %}
      <p class="mensagem-vazia">Sem seguidores ainda.</p>
    {% endif %}

  </div>

  <div id="seguindo" class="tab-content">
    {% if seguindo %}
      <ul class="perfil-lista-usuarios">
        {% for rel in seguindo %}
          <li>
            <a href="{% url 'perfil' rel.seguindo.username %}">
              {% if rel.seguindo.profile.imagem %}
                <img src="{{ rel.seguindo.profile.imagem.url }}" alt="Foto de {{ rel.seguindo.username }}">
              {% else %}
                <img src="{% static 'img/default-profile.png' %}" alt="Foto padrão">
              {% endif %}

              <div class="info">
                <strong>{{ rel.seguindo.first_name }}</strong>
                <span>@{{ rel.seguindo.username }}</span>

              </div>

            </a>

          </li>
        {% endfor %}

      </ul>

    {% else %}
      <p class="mensagem-vazia">Não está seguindo ninguém ainda.</p>
    {% endif %}

  </div>

</div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/perfil.js' %}"></script>
{% endblock %}